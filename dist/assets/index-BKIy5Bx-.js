import{r as V,g as Y}from"./phaser-Czz4FBZH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();var X=V();const f=Y(X);class z extends f.Scene{constructor(){super("BootScene")}create(){this.registry.set("p1Wins",0),this.registry.set("p2Wins",0),this.registry.set("currentRound",1),this.scene.start("TitleScene")}}const d={GROUND_Y:620,STAGE_LEFT:50,STAGE_RIGHT:1230,MAX_HEALTH:100,PUNCH_DURATION:250,PUNCH_KNOCKBACK:200,KICK_DURATION:400,KICK_KNOCKBACK:350,SPECIAL_DURATION:500,SPECIAL_KNOCKBACK:500,SPECIAL_COOLDOWN:3e3,BLOCK_DAMAGE_REDUCTION:.8,ROUNDS_TO_WIN:2,ROUND_END_DELAY:2e3,HITSTUN_DURATION:300,HEAD_RADIUS:14,LINE_WIDTH:4,BODY_WIDTH:40,BODY_HEIGHT:120};class L{constructor(t){this.graphics=t}draw(t,e,i,s,a=16777215){const n=this.graphics,h=s?1:-1;n.clear();const o={};for(const u in i)o[u]={x:t+i[u].x*h,y:e+i[u].y};const c=d.LINE_WIDTH,p=d.HEAD_RADIUS;n.fillStyle(a,.3),n.fillCircle(o.head.x,o.head.y,p),n.lineStyle(c,a,1),n.strokeCircle(o.head.x,o.head.y,p),this.drawLine(o.neck,o.hip,a),this.drawLine(o.shoulderL,o.shoulderR,a),this.drawLine(o.shoulderL,o.elbowL,a),this.drawLine(o.elbowL,o.handL,a),this.drawLine(o.shoulderR,o.elbowR,a),this.drawLine(o.elbowR,o.handR,a),this.drawLine(o.hip,o.kneeL,a),this.drawLine(o.kneeL,o.footL,a),this.drawLine(o.hip,o.kneeR,a),this.drawLine(o.kneeR,o.footR,a)}drawLine(t,e,i){this.graphics.lineStyle(d.LINE_WIDTH,i,1),this.graphics.lineBetween(t.x,t.y,e.x,e.y)}}const H={head:{x:0,y:-90},neck:{x:0,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-22,y:-50},elbowR:{x:22,y:-50},handL:{x:-18,y:-35},handR:{x:18,y:-35},kneeL:{x:-10,y:25},kneeR:{x:10,y:25},footL:{x:-15,y:50},footR:{x:15,y:50}},w={IDLE:[H,{...H,head:{x:0,y:-88},neck:{x:0,y:-70},handL:{x:-20,y:-33},handR:{x:20,y:-33}}],WALK_FORWARD:[{head:{x:2,y:-90},neck:{x:2,y:-72},hip:{x:0,y:0},shoulderL:{x:-12,y:-70},shoulderR:{x:16,y:-70},elbowL:{x:-25,y:-55},elbowR:{x:25,y:-45},handL:{x:-20,y:-40},handR:{x:22,y:-30},kneeL:{x:-5,y:22},kneeR:{x:15,y:22},footL:{x:-10,y:50},footR:{x:22,y:50}},{head:{x:2,y:-90},neck:{x:2,y:-72},hip:{x:0,y:0},shoulderL:{x:-12,y:-70},shoulderR:{x:16,y:-70},elbowL:{x:-18,y:-45},elbowR:{x:20,y:-55},handL:{x:-15,y:-30},handR:{x:18,y:-40},kneeL:{x:-15,y:22},kneeR:{x:5,y:22},footL:{x:-22,y:50},footR:{x:10,y:50}}],WALK_BACKWARD:[{head:{x:-2,y:-90},neck:{x:-2,y:-72},hip:{x:0,y:0},shoulderL:{x:-16,y:-70},shoulderR:{x:12,y:-70},elbowL:{x:-20,y:-45},elbowR:{x:18,y:-55},handL:{x:-18,y:-30},handR:{x:15,y:-40},kneeL:{x:-15,y:22},kneeR:{x:5,y:22},footL:{x:-22,y:50},footR:{x:10,y:50}},{head:{x:-2,y:-90},neck:{x:-2,y:-72},hip:{x:0,y:0},shoulderL:{x:-16,y:-70},shoulderR:{x:12,y:-70},elbowL:{x:-25,y:-55},elbowR:{x:25,y:-45},handL:{x:-22,y:-40},handR:{x:22,y:-30},kneeL:{x:-5,y:22},kneeR:{x:15,y:22},footL:{x:-10,y:50},footR:{x:22,y:50}}],JUMP:[{head:{x:0,y:-85},neck:{x:0,y:-68},hip:{x:0,y:0},shoulderL:{x:-14,y:-66},shoulderR:{x:14,y:-66},elbowL:{x:-24,y:-75},elbowR:{x:24,y:-75},handL:{x:-20,y:-85},handR:{x:20,y:-85},kneeL:{x:-16,y:15},kneeR:{x:16,y:15},footL:{x:-20,y:35},footR:{x:20,y:35}}],PUNCH:[{head:{x:-2,y:-90},neck:{x:-2,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-22,y:-50},elbowR:{x:8,y:-55},handL:{x:-18,y:-35},handR:{x:0,y:-50},kneeL:{x:-10,y:25},kneeR:{x:10,y:25},footL:{x:-15,y:50},footR:{x:15,y:50}},{head:{x:4,y:-90},neck:{x:4,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-22,y:-50},elbowR:{x:35,y:-65},handL:{x:-18,y:-35},handR:{x:55,y:-65},kneeL:{x:-10,y:25},kneeR:{x:12,y:25},footL:{x:-15,y:50},footR:{x:15,y:50}},{head:{x:2,y:-90},neck:{x:2,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-22,y:-50},elbowR:{x:25,y:-55},handL:{x:-18,y:-35},handR:{x:30,y:-45},kneeL:{x:-10,y:25},kneeR:{x:10,y:25},footL:{x:-15,y:50},footR:{x:15,y:50}}],KICK:[{head:{x:-4,y:-90},neck:{x:-4,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-22,y:-50},elbowR:{x:22,y:-50},handL:{x:-18,y:-35},handR:{x:18,y:-35},kneeL:{x:-10,y:25},kneeR:{x:20,y:5},footL:{x:-15,y:50},footR:{x:15,y:15}},{head:{x:-2,y:-90},neck:{x:-2,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-25,y:-55},elbowR:{x:20,y:-55},handL:{x:-22,y:-40},handR:{x:16,y:-40},kneeL:{x:-10,y:25},kneeR:{x:35,y:5},footL:{x:-15,y:50},footR:{x:65,y:0}},{head:{x:-2,y:-90},neck:{x:-2,y:-72},hip:{x:0,y:0},shoulderL:{x:-14,y:-70},shoulderR:{x:14,y:-70},elbowL:{x:-22,y:-50},elbowR:{x:22,y:-50},handL:{x:-18,y:-35},handR:{x:18,y:-35},kneeL:{x:-10,y:25},kneeR:{x:18,y:15},footL:{x:-15,y:50},footR:{x:25,y:40}}],SPECIAL:[{head:{x:-4,y:-80},neck:{x:-4,y:-62},hip:{x:0,y:5},shoulderL:{x:-16,y:-60},shoulderR:{x:16,y:-60},elbowL:{x:-28,y:-45},elbowR:{x:10,y:-50},handL:{x:-30,y:-30},handR:{x:0,y:-45},kneeL:{x:-14,y:28},kneeR:{x:14,y:28},footL:{x:-20,y:50},footR:{x:18,y:50}},{head:{x:15,y:-85},neck:{x:12,y:-68},hip:{x:0,y:0},shoulderL:{x:-5,y:-66},shoulderR:{x:22,y:-66},elbowL:{x:-10,y:-50},elbowR:{x:45,y:-60},handL:{x:-5,y:-35},handR:{x:65,y:-55},kneeL:{x:-18,y:20},kneeR:{x:20,y:15},footL:{x:-30,y:50},footR:{x:30,y:50}},{head:{x:5,y:-88},neck:{x:4,y:-70},hip:{x:0,y:0},shoulderL:{x:-12,y:-68},shoulderR:{x:16,y:-68},elbowL:{x:-20,y:-50},elbowR:{x:30,y:-52},handL:{x:-16,y:-35},handR:{x:35,y:-40},kneeL:{x:-10,y:25},kneeR:{x:12,y:25},footL:{x:-15,y:50},footR:{x:16,y:50}}],BLOCK:[{head:{x:-4,y:-88},neck:{x:-4,y:-70},hip:{x:0,y:2},shoulderL:{x:-14,y:-68},shoulderR:{x:14,y:-68},elbowL:{x:-8,y:-52},elbowR:{x:8,y:-52},handL:{x:2,y:-65},handR:{x:6,y:-42},kneeL:{x:-12,y:26},kneeR:{x:12,y:26},footL:{x:-16,y:50},footR:{x:16,y:50}}],HIT:[{head:{x:-8,y:-88},neck:{x:-6,y:-70},hip:{x:0,y:2},shoulderL:{x:-16,y:-68},shoulderR:{x:10,y:-68},elbowL:{x:-28,y:-55},elbowR:{x:5,y:-50},handL:{x:-30,y:-40},handR:{x:-5,y:-38},kneeL:{x:-8,y:26},kneeR:{x:12,y:26},footL:{x:-12,y:50},footR:{x:18,y:50}}],KO:[{head:{x:-15,y:-75},neck:{x:-10,y:-58},hip:{x:0,y:5},shoulderL:{x:-18,y:-55},shoulderR:{x:2,y:-55},elbowL:{x:-30,y:-40},elbowR:{x:-8,y:-38},handL:{x:-35,y:-25},handR:{x:-15,y:-22},kneeL:{x:-5,y:28},kneeR:{x:15,y:28},footL:{x:-10,y:50},footR:{x:22,y:50}},{head:{x:-35,y:30},neck:{x:-25,y:35},hip:{x:0,y:40},shoulderL:{x:-28,y:32},shoulderR:{x:-22,y:38},elbowL:{x:-35,y:42},elbowR:{x:-15,y:45},handL:{x:-42,y:48},handR:{x:-8,y:50},kneeL:{x:15,y:38},kneeR:{x:20,y:42},footL:{x:30,y:45},footR:{x:38,y:48}}],VICTORY:[{head:{x:0,y:-95},neck:{x:0,y:-75},hip:{x:0,y:0},shoulderL:{x:-14,y:-73},shoulderR:{x:14,y:-73},elbowL:{x:-22,y:-88},elbowR:{x:22,y:-88},handL:{x:-28,y:-105},handR:{x:28,y:-105},kneeL:{x:-10,y:25},kneeR:{x:10,y:25},footL:{x:-15,y:50},footR:{x:15,y:50}}]};function J(r,t,e){const i={};for(const s in r)i[s]={x:r[s].x+(t[s].x-r[s].x)*e,y:r[s].y+(t[s].y-r[s].y)*e};return i}let I=null;function S(){return I||(I=new(window.AudioContext||window.webkitAudioContext)),I.state==="suspended"&&I.resume(),I}function x(r,t,e="square",i=.15,s=!0){const a=S(),n=a.createOscillator(),h=a.createGain();n.type=e,n.frequency.value=r,h.gain.value=i,s&&h.gain.exponentialRampToValueAtTime(.001,a.currentTime+t),n.connect(h),h.connect(a.destination),n.start(a.currentTime),n.stop(a.currentTime+t)}function R(r,t=.1){const e=S(),i=e.sampleRate*r,s=e.createBuffer(1,i,e.sampleRate),a=s.getChannelData(0);for(let c=0;c<i;c++)a[c]=Math.random()*2-1;const n=e.createBufferSource();n.buffer=s;const h=e.createGain();h.gain.value=t,h.gain.exponentialRampToValueAtTime(.001,e.currentTime+r);const o=e.createBiquadFilter();o.type="bandpass",o.frequency.value=1e3,o.Q.value=.5,n.connect(o),o.connect(h),h.connect(e.destination),n.start(e.currentTime)}const y={punch(){x(200,.08,"square",.12),R(.06,.1)},kick(){x(140,.12,"square",.15),R(.1,.12),x(80,.1,"sine",.2)},special(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="sawtooth",t.frequency.value=150,t.frequency.exponentialRampToValueAtTime(600,r.currentTime+.2),e.gain.value=.12,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.3),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.3),R(.15,.1)},block(){x(400,.06,"triangle",.08),x(300,.08,"triangle",.06)},hit(){x(160,.1,"square",.15),R(.08,.15),x(60,.15,"sine",.2)},ko(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="sawtooth",t.frequency.value=400,t.frequency.exponentialRampToValueAtTime(50,r.currentTime+.8),e.gain.value=.15,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.8),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.8),R(.4,.12)},roundStart(){x(440,.1,"square",.08),setTimeout(()=>x(440,.1,"square",.08),200),setTimeout(()=>x(880,.2,"square",.1),400)},menuSelect(){x(660,.08,"square",.08),setTimeout(()=>x(880,.1,"square",.1),60)},victory(){[523,659,784,1047].forEach((t,e)=>{setTimeout(()=>x(t,.2,"square",.1),e*150)})},jump(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="sine",t.frequency.value=250,t.frequency.exponentialRampToValueAtTime(500,r.currentTime+.1),e.gain.value=.06,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.12),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.12)},land(){x(80,.06,"sine",.08)},whoosh(){R(.1,.04)},boom(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="sine",t.frequency.value=60,t.frequency.exponentialRampToValueAtTime(20,r.currentTime+.4),e.gain.value=.25,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.4),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.4),R(.3,.18)},warp(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="sine",t.frequency.value=800,t.frequency.exponentialRampToValueAtTime(100,r.currentTime+.15),e.gain.value=.1,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.15),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.15),setTimeout(()=>{const i=r.createOscillator(),s=r.createGain();i.type="sine",i.frequency.value=100,i.frequency.exponentialRampToValueAtTime(600,r.currentTime+.1),s.gain.value=.1,s.gain.exponentialRampToValueAtTime(.001,r.currentTime+.12),i.connect(s),s.connect(r.destination),i.start(r.currentTime),i.stop(r.currentTime+.12)},100)},electric(){const r=S();for(let t=0;t<4;t++)setTimeout(()=>{const e=r.createOscillator(),i=r.createGain();e.type="square",e.frequency.value=800+Math.random()*1200,i.gain.value=.06,i.gain.exponentialRampToValueAtTime(.001,r.currentTime+.05),e.connect(i),i.connect(r.destination),e.start(r.currentTime),e.stop(r.currentTime+.05)},t*30);R(.12,.08)},heavyImpact(){x(50,.2,"sine",.25),x(100,.15,"square",.12),R(.12,.15)},iceSlide(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="triangle",t.frequency.value=1200,t.frequency.exponentialRampToValueAtTime(400,r.currentTime+.2),e.gain.value=.06,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.25),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.25),R(.15,.04)},flurryHit(){x(300+Math.random()*200,.04,"square",.08),R(.03,.06)},risingAttack(){const r=S(),t=r.createOscillator(),e=r.createGain();t.type="sawtooth",t.frequency.value=200,t.frequency.exponentialRampToValueAtTime(800,r.currentTime+.15),e.gain.value=.1,e.gain.exponentialRampToValueAtTime(.001,r.currentTime+.2),t.connect(e),e.connect(r.destination),t.start(r.currentTime),t.stop(r.currentTime+.2)}};class q extends f.Scene{constructor(){super("TitleScene")}create(){this.add.text(640,160,"STICK FIGHTER",{fontSize:"72px",fontFamily:"monospace",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.add.text(640,240,"A game of sticks and honor",{fontSize:"20px",fontFamily:"monospace",color:"#888888"}).setOrigin(.5);const t=this.add.graphics();new L(t).draw(440,480,w.IDLE[0],!0,16777215);const i=this.add.graphics();new L(i).draw(840,480,w.IDLE[0],!1,65535),this.add.text(640,560,"P1: WASD + J/K/L    P2: Arrows + , . /",{fontSize:"16px",fontFamily:"monospace",color:"#666666"}).setOrigin(.5),this.add.text(640,585,"Gamepads supported!",{fontSize:"14px",fontFamily:"monospace",color:"#555555"}).setOrigin(.5),this.promptText=this.add.text(640,650,"Press ENTER or SPACE to fight!",{fontSize:"24px",fontFamily:"monospace",color:"#ffcc00"}).setOrigin(.5),this.tweens.add({targets:this.promptText,alpha:.3,duration:600,yoyo:!0,repeat:-1}),this.input.keyboard.on("keydown-ENTER",this.startGame,this),this.input.keyboard.on("keydown-SPACE",this.startGame,this),this.input.gamepad.on("down",(a,n)=>{this.startGame()})}startGame(){y.menuSelect(),this.scene.start("CharacterSelectScene")}}const k=[{id:"swift",name:"Swift",color:16777215,description:"Balanced fighter with a quick lunge.",moveSpeed:300,jumpVelocity:-650,punchDamage:8,punchRange:60,kickDamage:14,kickRange:80,specialDamage:22,specialRange:100,specialType:"lunge",specialName:"Dash Strike",specialDuration:500},{id:"titan",name:"Titan",color:65535,description:"Slow powerhouse. Ground pound shakes the arena.",moveSpeed:220,jumpVelocity:-520,punchDamage:11,punchRange:65,kickDamage:19,kickRange:85,specialDamage:28,specialRange:120,specialType:"groundPound",specialName:"Ground Pound",specialDuration:900},{id:"shadow",name:"Shadow",color:12272895,description:"Fragile but lightning fast. Teleports behind foes.",moveSpeed:380,jumpVelocity:-700,punchDamage:7,punchRange:55,kickDamage:12,kickRange:75,specialDamage:18,specialRange:60,specialType:"teleport",specialName:"Shadow Step",specialDuration:550,maxHealth:80},{id:"blaze",name:"Blaze",color:16737792,description:"Aggressive brawler with a fiery uppercut.",moveSpeed:280,jumpVelocity:-620,punchDamage:9,punchRange:58,kickDamage:15,kickRange:78,specialDamage:24,specialRange:70,specialType:"uppercut",specialName:"Fire Uppercut",specialDuration:650},{id:"frost",name:"Frost",color:6737151,description:"Cool and collected. Ice slide covers distance fast.",moveSpeed:260,jumpVelocity:-600,punchDamage:8,punchRange:60,kickDamage:14,kickRange:80,specialDamage:20,specialRange:130,specialType:"slide",specialName:"Ice Slide",specialDuration:550},{id:"thunder",name:"Thunder",color:16776960,description:"Electrifying strikes. Lightning drop from above.",moveSpeed:270,jumpVelocity:-680,punchDamage:9,punchRange:60,kickDamage:16,kickRange:82,specialDamage:26,specialRange:90,specialType:"lightningDrop",specialName:"Lightning Drop",specialDuration:800},{id:"viper",name:"Viper",color:4521796,description:"Quick multi-hit combos. Rapid dash flurry.",moveSpeed:330,jumpVelocity:-640,punchDamage:6,punchRange:55,kickDamage:10,kickRange:70,specialDamage:8,specialRange:80,specialType:"flurry",specialName:"Viper Flurry",specialHits:4,specialDuration:700},{id:"golem",name:"Golem",color:11176021,description:"Immovable wall. Absorbs a hit during special.",moveSpeed:180,jumpVelocity:-450,punchDamage:13,punchRange:70,kickDamage:22,kickRange:90,specialDamage:30,specialRange:90,specialType:"armorSmash",specialName:"Armor Smash",specialDuration:800,maxHealth:120},{id:"phantom",name:"Phantom",color:14540287,description:"Floaty and evasive. Spinning whirlwind attack.",moveSpeed:290,jumpVelocity:-750,punchDamage:7,punchRange:55,kickDamage:12,kickRange:75,specialDamage:16,specialRange:110,specialType:"whirlwind",specialName:"Whirlwind",specialDuration:650},{id:"nova",name:"Nova",color:16724838,description:"Glass cannon. Massive explosive burst.",moveSpeed:260,jumpVelocity:-600,punchDamage:10,punchRange:58,kickDamage:16,kickRange:78,specialDamage:38,specialRange:140,specialType:"explosion",specialName:"Nova Burst",specialDuration:700,maxHealth:70}],g=5,M=2,m=200,b=180,O=140,P=120;class j extends f.Scene{constructor(){super("CharacterSelectScene")}create(){this.p1Index=0,this.p2Index=1,this.p1Locked=!1,this.p2Locked=!1,this.add.text(640,40,"SELECT YOUR FIGHTER",{fontSize:"36px",fontFamily:"monospace",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.add.text(640,80,"P1: WASD + J to lock    P2: Arrows + , to lock",{fontSize:"14px",fontFamily:"monospace",color:"#666666"}).setOrigin(.5),this.cellGraphics=[],this.cellTexts=[];for(let t=0;t<k.length;t++){const e=t%g,i=Math.floor(t/g),s=O+e*m+m/2,a=P+i*b+b/2,n=k[t],h=this.add.graphics();this.cellGraphics.push(h);const o=this.add.text(s,a+50,n.name,{fontSize:"14px",fontFamily:"monospace",color:"#aaaaaa"}).setOrigin(.5);this.cellTexts.push(o);const c=this.add.graphics();new L(c).draw(s,a+20,w.IDLE[0],!0,n.color)}this.p1Info=this.add.text(200,520,"",{fontSize:"16px",fontFamily:"monospace",color:"#ffffff",wordWrap:{width:350}}).setOrigin(.5,0),this.p2Info=this.add.text(1080,520,"",{fontSize:"16px",fontFamily:"monospace",color:"#ffffff",wordWrap:{width:350}}).setOrigin(.5,0),this.add.text(200,495,"PLAYER 1",{fontSize:"20px",fontFamily:"monospace",color:"#ffcc00",fontStyle:"bold"}).setOrigin(.5),this.add.text(1080,495,"PLAYER 2",{fontSize:"20px",fontFamily:"monospace",color:"#ffcc00",fontStyle:"bold"}).setOrigin(.5),this.p1LockText=this.add.text(200,660,"",{fontSize:"18px",fontFamily:"monospace",color:"#00ff00"}).setOrigin(.5),this.p2LockText=this.add.text(1080,660,"",{fontSize:"18px",fontFamily:"monospace",color:"#00ff00"}).setOrigin(.5),this.startText=this.add.text(640,690,"",{fontSize:"20px",fontFamily:"monospace",color:"#ffcc00"}).setOrigin(.5),this.highlightGraphics=this.add.graphics(),this.highlightGraphics.setDepth(50),this.p1Keys={up:this.input.keyboard.addKey("W"),down:this.input.keyboard.addKey("S"),left:this.input.keyboard.addKey("A"),right:this.input.keyboard.addKey("D"),confirm:this.input.keyboard.addKey("J"),cancel:this.input.keyboard.addKey("K")},this.p2Keys={up:this.input.keyboard.addKey("UP"),down:this.input.keyboard.addKey("DOWN"),left:this.input.keyboard.addKey("LEFT"),right:this.input.keyboard.addKey("RIGHT"),confirm:this.input.keyboard.addKey("COMMA"),cancel:this.input.keyboard.addKey("PERIOD")},this.p1PadPrev={},this.p2PadPrev={},this.updateDisplay()}update(){this.p1Locked?(f.Input.Keyboard.JustDown(this.p1Keys.cancel)||this.padJustPressed(1,"B"))&&this.unlock(1):((f.Input.Keyboard.JustDown(this.p1Keys.left)||this.padJustPressed(1,"left"))&&this.moveSelection(1,-1,0),(f.Input.Keyboard.JustDown(this.p1Keys.right)||this.padJustPressed(1,"right"))&&this.moveSelection(1,1,0),(f.Input.Keyboard.JustDown(this.p1Keys.up)||this.padJustPressed(1,"up"))&&this.moveSelection(1,0,-1),(f.Input.Keyboard.JustDown(this.p1Keys.down)||this.padJustPressed(1,"down"))&&this.moveSelection(1,0,1),(f.Input.Keyboard.JustDown(this.p1Keys.confirm)||this.padJustPressed(1,"A"))&&this.lockIn(1)),this.p2Locked?(f.Input.Keyboard.JustDown(this.p2Keys.cancel)||this.padJustPressed(2,"B"))&&this.unlock(2):((f.Input.Keyboard.JustDown(this.p2Keys.left)||this.padJustPressed(2,"left"))&&this.moveSelection(2,-1,0),(f.Input.Keyboard.JustDown(this.p2Keys.right)||this.padJustPressed(2,"right"))&&this.moveSelection(2,1,0),(f.Input.Keyboard.JustDown(this.p2Keys.up)||this.padJustPressed(2,"up"))&&this.moveSelection(2,0,-1),(f.Input.Keyboard.JustDown(this.p2Keys.down)||this.padJustPressed(2,"down"))&&this.moveSelection(2,0,1),(f.Input.Keyboard.JustDown(this.p2Keys.confirm)||this.padJustPressed(2,"A"))&&this.lockIn(2)),this.updatePadPrev()}getPad(t){if(!this.input.gamepad)return null;const e=this.input.gamepad.gamepads.filter(s=>s&&s.connected),i=t-1;return e.find(s=>s.index===i)||null}padJustPressed(t,e){const i=this.getPad(t),s=t===1?this.p1PadPrev:this.p2PadPrev;if(!i)return!1;const a=.5,n=i.leftStick?i.leftStick.x:0,h=i.leftStick?i.leftStick.y:0;let o=!1;switch(e){case"left":o=i.left||n<-a;break;case"right":o=i.right||n>a;break;case"up":o=i.up||h<-a;break;case"down":o=i.down||h>a;break;case"A":o=i.A;break;case"B":o=i.B;break}return o&&!s[e]}updatePadPrev(){for(const t of[1,2]){const e=this.getPad(t),i=t===1?this.p1PadPrev:this.p2PadPrev;if(!e)continue;const s=.5,a=e.leftStick?e.leftStick.x:0,n=e.leftStick?e.leftStick.y:0;i.left=e.left||a<-s,i.right=e.right||a>s,i.up=e.up||n<-s,i.down=e.down||n>s,i.A=e.A,i.B=e.B}}moveSelection(t,e,i){const s=t===1?this.p1Index:this.p2Index;let a=s%g,n=Math.floor(s/g);a+=e,n+=i,a<0&&(a=g-1),a>=g&&(a=0),n<0&&(n=M-1),n>=M&&(n=0);const h=n*g+a;h>=0&&h<k.length&&(t===1?this.p1Index=h:this.p2Index=h,y.menuSelect(),this.updateDisplay())}lockIn(t){t===1?this.p1Locked=!0:this.p2Locked=!0,y.roundStart(),this.updateDisplay(),this.p1Locked&&this.p2Locked&&this.time.delayedCall(500,()=>this.startFight())}unlock(t){t===1?this.p1Locked=!1:this.p2Locked=!1,y.block(),this.updateDisplay()}updateDisplay(){const t=this.highlightGraphics;t.clear();for(let T=0;T<k.length;T++){const _=T%g,K=Math.floor(T/g),A=O+_*m,E=P+K*b,D=this.cellGraphics[T];D.clear(),D.fillStyle(1710654,.6),D.fillRect(A+4,E+4,m-8,b-8),D.lineStyle(1,3355494,.8),D.strokeRect(A+4,E+4,m-8,b-8)}const e=this.p1Index%g,i=Math.floor(this.p1Index/g),s=O+e*m,a=P+i*b;t.lineStyle(3,this.p1Locked?65280:16763904,1),t.strokeRect(s+2,a+2,m-4,b-4),t.fillStyle(this.p1Locked?65280:16763904,1),t.fillTriangle(s+10,a+8,s+22,a+8,s+16,a+18),t.fillStyle(0,1),this.add.text;const n=this.p2Index%g,h=Math.floor(this.p2Index/g),o=O+n*m,c=P+h*b;t.lineStyle(3,this.p2Locked?65280:52479,1),t.strokeRect(o+6,c+6,m-12,b-12),t.fillStyle(this.p2Locked?65280:52479,1),t.fillTriangle(o+m-10,c+8,o+m-22,c+8,o+m-16,c+18);const p=k[this.p1Index],u=k[this.p2Index];this.p1Info.setText(`${p.name}
${p.description}

SPD: ${"|".repeat(Math.round(p.moveSpeed/40))}  HP: ${p.maxHealth||100}
Special: ${p.specialName}`),this.p1Info.setColor(`#${p.color.toString(16).padStart(6,"0")}`),this.p2Info.setText(`${u.name}
${u.description}

SPD: ${"|".repeat(Math.round(u.moveSpeed/40))}  HP: ${u.maxHealth||100}
Special: ${u.specialName}`),this.p2Info.setColor(`#${u.color.toString(16).padStart(6,"0")}`),this.p1LockText.setText(this.p1Locked?"LOCKED IN!":""),this.p2LockText.setText(this.p2Locked?"LOCKED IN!":""),this.p1Locked&&this.p2Locked?this.startText.setText("GET READY..."):this.startText.setText("")}startFight(){this.registry.set("p1Fighter",this.p1Index),this.registry.set("p2Fighter",this.p2Index),this.registry.set("p1Wins",0),this.registry.set("p2Wins",0),this.registry.set("currentRound",1),this.scene.start("FightScene")}}function $(r,t,e,i,s,a=5){const n=r.add.graphics().setDepth(8);for(let h=0;h<a;h++){const o=e-30+Math.random()*60,c=t-i*(10+h*12),p=20+Math.random()*25;n.lineStyle(2,s,.6-h*.08),n.lineBetween(c,o,c-i*p,o)}r.tweens.add({targets:n,alpha:0,duration:200,onComplete:()=>n.destroy()})}function C(r,t,e,i=11184810){const s=r.add.graphics().setDepth(8);for(let a=0;a<6;a++){const n=Math.random()*Math.PI*2,h=5+Math.random()*15,o=3+Math.random()*4;s.fillStyle(i,.4),s.fillCircle(t+Math.cos(n)*h,e+Math.sin(n)*h,o)}r.tweens.add({targets:s,alpha:0,duration:400,onComplete:()=>s.destroy()})}function v(r,t,e,i,s=80){const a=r.add.graphics().setDepth(12);r.tweens.addCounter({from:10,to:s,duration:400,onUpdate:n=>{a.clear();const h=n.getValue(),o=(h-10)/(s-10);a.lineStyle(3,i,(1-o)*.8),a.strokeCircle(t,e,h),a.lineStyle(2,16777215,(1-o)*.4),a.strokeCircle(t,e,h*.6)},onComplete:()=>a.destroy()})}function Z(r,t,e,i=16737792,s=8){const a=r.add.graphics().setDepth(8),n=[];for(let h=0;h<s;h++)n.push({x:t+(Math.random()-.5)*20,y:e+(Math.random()-.5)*20,vx:(Math.random()-.5)*80,vy:-100-Math.random()*150,size:2+Math.random()*4});r.tweens.addCounter({from:0,to:1,duration:500,onUpdate:h=>{a.clear();const o=h.getValue();n.forEach(c=>{c.x+=c.vx*.016,c.y+=c.vy*.016,c.vy+=120*.016,a.fillStyle(i,1-o),a.fillCircle(c.x,c.y,c.size*(1-o*.5)),a.fillStyle(16776960,(1-o)*.5),a.fillCircle(c.x,c.y,c.size*.4)})},onComplete:()=>a.destroy()})}function Q(r,t,e,i,s=16737792){const a=r.add.graphics().setDepth(7);for(let n=0;n<4;n++){const h=t-i*(n*8)+(Math.random()-.5)*10,o=e+(Math.random()-.5)*15,c=3+Math.random()*5;a.fillStyle(s,.6),a.fillCircle(h,o,c),a.fillStyle(16777028,.3),a.fillCircle(h,o,c*.5)}r.tweens.add({targets:a,alpha:0,duration:250,onComplete:()=>a.destroy()})}function tt(r,t,e,i,s=6737151){const a=r.add.graphics().setDepth(5);for(let n=0;n<6;n++){const h=t-i*n*18+(Math.random()-.5)*8,o=e+(Math.random()-.5)*6,c=3+Math.random()*5;a.fillStyle(s,.6),a.fillTriangle(h,o-c,h-c*.6,o,h+c*.6,o),a.fillTriangle(h,o+c,h-c*.6,o,h+c*.6,o),a.fillStyle(16777215,.3),a.fillCircle(h,o-c*.3,1.5)}r.tweens.add({targets:a,alpha:0,duration:600,onComplete:()=>a.destroy()})}function et(r,t,e,i=6737151){const s=r.add.graphics().setDepth(12),a=[];for(let n=0;n<6;n++){const h=Math.random()*Math.PI*2,o=60+Math.random()*100;a.push({x:t,y:e,vx:Math.cos(h)*o,vy:Math.sin(h)*o-40,size:2+Math.random()*3})}r.tweens.addCounter({from:0,to:1,duration:400,onUpdate:n=>{s.clear();const h=n.getValue();a.forEach(o=>{o.x+=o.vx*.016,o.y+=o.vy*.016,s.fillStyle(i,1-h),s.fillCircle(o.x,o.y,o.size)})},onComplete:()=>s.destroy()})}function it(r,t,e,i,s,a=16776960){const n=r.add.graphics().setDepth(15),h=8,o=[{x:t,y:e}];for(let c=1;c<h;c++){const p=c/h;o.push({x:t+(i-t)*p+(Math.random()-.5)*40,y:e+(s-e)*p+(Math.random()-.5)*10})}o.push({x:i,y:s}),n.lineStyle(8,a,.3);for(let c=0;c<o.length-1;c++)n.lineBetween(o[c].x,o[c].y,o[c+1].x,o[c+1].y);n.lineStyle(3,a,1);for(let c=0;c<o.length-1;c++)n.lineBetween(o[c].x,o[c].y,o[c+1].x,o[c+1].y);n.lineStyle(1,16777215,.9);for(let c=0;c<o.length-1;c++)n.lineBetween(o[c].x,o[c].y,o[c+1].x,o[c+1].y);r.tweens.add({targets:n,alpha:0,duration:150,onComplete:()=>n.destroy()})}function N(r,t,e,i=16776960,s=10){const a=r.add.graphics().setDepth(12),n=[];for(let h=0;h<s;h++){const o=Math.random()*Math.PI*2,c=100+Math.random()*200;n.push({x:t,y:e,vx:Math.cos(o)*c,vy:Math.sin(o)*c-50,len:4+Math.random()*8})}r.tweens.addCounter({from:0,to:1,duration:300,onUpdate:h=>{a.clear();const o=h.getValue();n.forEach(c=>{c.x+=c.vx*.016,c.y+=c.vy*.016;const p=Math.atan2(c.vy,c.vx);a.lineStyle(2,i,1-o),a.lineBetween(c.x,c.y,c.x-Math.cos(p)*c.len,c.y-Math.sin(p)*c.len)})},onComplete:()=>a.destroy()})}function st(r,t,e,i,s=4521796){const a=r.add.graphics().setDepth(12),n=t+i*35,h=Math.random()*.5-.25,o=20+Math.random()*15;a.lineStyle(3,s,.9),a.lineBetween(n-Math.cos(h)*o,e-Math.sin(h)*o,n+Math.cos(h)*o,e+Math.sin(h)*o),a.lineStyle(1,16777215,.6),a.lineBetween(n-Math.cos(h)*o,e-Math.sin(h)*o,n+Math.cos(h)*o,e+Math.sin(h)*o),r.tweens.add({targets:a,alpha:0,duration:120,onComplete:()=>a.destroy()})}function at(r,t,e,i=11176021,s=40){const a=r.add.graphics().setDepth(7);a.fillStyle(i,.15),a.fillCircle(t,e,s),a.lineStyle(3,i,.6),a.strokeCircle(t,e,s),a.lineStyle(6,i,.2),a.strokeCircle(t,e,s+5),r.tweens.add({targets:a,alpha:0,duration:200,onComplete:()=>a.destroy()})}function nt(r,t,e,i,s=14540287){const a=r.add.graphics().setDepth(8),n=40;for(let h=0;h<3;h++){const o=i+h*Math.PI*2/3;a.lineStyle(3,s,.7),a.beginPath(),a.arc(t,e,n+h*6,o,o+Math.PI*.6),a.strokePath()}for(let h=0;h<4;h++){const o=i*.5+h*Math.PI/2,c=n+12+Math.random()*10;a.fillStyle(11184810,.3),a.fillCircle(t+Math.cos(o)*c,e+Math.sin(o)*c,2)}r.tweens.add({targets:a,alpha:0,duration:120,onComplete:()=>a.destroy()})}function ot(r,t,e,i,s){const a=r.add.graphics().setDepth(8);a.fillStyle(i,.15),a.fillCircle(t,e,s),a.lineStyle(2,i,.5),a.strokeCircle(t,e,s),a.fillStyle(16777215,.2),a.fillCircle(t,e,s*.3),r.tweens.add({targets:a,alpha:0,duration:80,onComplete:()=>a.destroy()})}function rt(r,t,e,i,s=120){const a=r.add.graphics().setDepth(100);a.fillStyle(i,.3),a.fillRect(0,0,1280,720),r.tweens.add({targets:a,alpha:0,duration:200,onComplete:()=>a.destroy()});const n=r.add.graphics().setDepth(15);r.tweens.addCounter({from:5,to:s,duration:400,onUpdate:h=>{n.clear();const o=h.getValue(),c=(o-5)/(s-5);n.lineStyle(4,i,(1-c)*.9),n.strokeCircle(t,e,o),n.lineStyle(2,16777215,(1-c)*.6),n.strokeCircle(t,e,o*.7);for(let p=0;p<8;p++){const u=p/8*Math.PI*2+c*3;n.fillStyle(i,(1-c)*.7),n.fillCircle(t+Math.cos(u)*o,e+Math.sin(u)*o,3)}},onComplete:()=>n.destroy()})}function ht(r,t,e,i=12272895){const s=r.add.graphics().setDepth(12);r.tweens.addCounter({from:0,to:1,duration:400,onUpdate:a=>{s.clear();const n=a.getValue();for(let h=0;h<8;h++){const o=h/8*Math.PI*2,c=n*25,p=6+n*8;s.fillStyle(i,(1-n)*.5),s.fillCircle(t+Math.cos(o)*c,e+Math.sin(o)*c,p*(1-n*.3))}},onComplete:()=>s.destroy()})}function ct(r,t,e,i=12272895){const s=r.add.graphics().setDepth(15);s.fillStyle(16777215,.8),s.fillCircle(t,e,15),s.fillStyle(i,.5),s.fillCircle(t,e,30);for(let a=0;a<6;a++){const n=a/6*Math.PI*2;s.lineStyle(2,i,.7),s.lineBetween(t,e,t+Math.cos(n)*35,e+Math.sin(n)*35)}r.tweens.add({targets:s,alpha:0,duration:250,onComplete:()=>s.destroy()})}function B(r,t,e,i=8947848){const s=r.add.graphics().setDepth(3);for(let a=0;a<5;a++){const n=-Math.PI*.8+a/4*Math.PI*.6,h=25+Math.random()*35,o=t+Math.cos(n)*h*.5+(Math.random()-.5)*8,c=e+Math.abs(Math.sin(n))*h*.2,p=t+Math.cos(n)*h+(Math.random()-.5)*12,u=e+Math.abs(Math.sin(n))*h*.15;s.lineStyle(2,i,.7),s.lineBetween(t,e,o,c),s.lineBetween(o,c,p,u)}r.tweens.add({targets:s,alpha:0,duration:1200,onComplete:()=>s.destroy()})}const l={IDLE:"IDLE",WALK_FORWARD:"WALK_FORWARD",WALK_BACKWARD:"WALK_BACKWARD",JUMP:"JUMP",PUNCH:"PUNCH",KICK:"KICK",SPECIAL:"SPECIAL",BLOCK:"BLOCK",HIT:"HIT",KO:"KO",VICTORY:"VICTORY"};class G{constructor(t,e,i,s,a,n){this.scene=t,this.playerIndex=s,this.facingRight=a,this.data=n,this.state=l.IDLE,this.maxHealth=n.maxHealth||d.MAX_HEALTH,this.health=this.maxHealth,this.stateTimer=0,this.specialCooldown=0,this.canAct=!0,this.hasHit=!1,this.specialHitCount=0,this.armorActive=!1,this._effectPhase=0,this._effectTimer=0,this.body=t.add.zone(e,i-d.BODY_HEIGHT/2,d.BODY_WIDTH,d.BODY_HEIGHT),t.physics.add.existing(this.body),this.body.body.setCollideWorldBounds(!0),this.graphics=t.add.graphics(),this.graphics.setDepth(10),this.renderer=new L(this.graphics),this.animFrame=0,this.animTimer=0}get x(){return this.body.x}get y(){return this.body.y}get isGrounded(){return this.body.body.blocked.down}get specialDuration(){return this.data.specialDuration||d.SPECIAL_DURATION}update(t,e){this.stateTimer+=t,this.animTimer+=t,this.specialCooldown=Math.max(0,this.specialCooldown-t),this.canAct&&this.state!==l.KO&&this.state!==l.VICTORY&&this.handleInput(e),this.updateState(t),this.draw()}handleInput(t){if(!this.canAct)return;const e=[l.IDLE,l.WALK_FORWARD,l.WALK_BACKWARD,l.BLOCK].includes(this.state),i=!this.isGrounded;if(e||i&&this.state===l.JUMP){if(t.special&&this.specialCooldown<=0&&this.isGrounded){this.enterState(l.SPECIAL),this.specialCooldown=d.SPECIAL_COOLDOWN;return}if(t.punch){this.enterState(l.PUNCH);return}if(t.kick){this.enterState(l.KICK);return}}if(t.block&&this.isGrounded&&e){this.state!==l.BLOCK&&this.enterState(l.BLOCK);return}if(this.state===l.BLOCK&&!t.block&&this.enterState(l.IDLE),t.jump&&this.isGrounded&&e){this.body.body.setVelocityY(this.data.jumpVelocity),this.enterState(l.JUMP);return}if(this.state!==l.BLOCK&&this.state!==l.JUMP)if(t.left){if(this.body.body.setVelocityX(-this.data.moveSpeed),this.isGrounded){const s=!this.facingRight;this.state=s?l.WALK_FORWARD:l.WALK_BACKWARD}}else if(t.right){if(this.body.body.setVelocityX(this.data.moveSpeed),this.isGrounded){const s=this.facingRight;this.state=s?l.WALK_FORWARD:l.WALK_BACKWARD}}else this.isGrounded&&e&&(this.body.body.setVelocityX(0),this.state!==l.IDLE&&(this.state=l.IDLE));this.state===l.JUMP&&(t.left?this.body.body.setVelocityX(-this.data.moveSpeed*.7):t.right&&this.body.body.setVelocityX(this.data.moveSpeed*.7))}updateState(t){switch(this.state){case l.PUNCH:this.stateTimer>=d.PUNCH_DURATION&&(this.canAct=!0,this.hasHit=!1,this.enterState(l.IDLE));break;case l.KICK:this.stateTimer>=d.KICK_DURATION&&(this.canAct=!0,this.hasHit=!1,this.enterState(l.IDLE));break;case l.SPECIAL:this.updateSpecial(t),this.stateTimer>=this.specialDuration&&(this.canAct=!0,this.hasHit=!1,this.specialHitCount=0,this.armorActive=!1,this._effectPhase=0,this._effectTimer=0,this.body.body.setVelocityX(0),this.enterState(l.IDLE));break;case l.HIT:this.stateTimer>=d.HITSTUN_DURATION&&(this.canAct=!0,this.enterState(l.IDLE));break;case l.JUMP:this.isGrounded&&this.stateTimer>100&&(this.body.body.setVelocityX(0),this.enterState(l.IDLE));break;case l.KO:if(this.stateTimer<500){const e=this.facingRight?-1:1;this.body.body.setVelocityX(e*100)}else this.body.body.setVelocityX(0);break}}updateSpecial(t){const e=this.stateTimer,i=this.specialDuration,s=this.facingRight?1:-1,a=d.BODY_HEIGHT,n=this.y+a/2;switch(this._effectTimer+=t,this.data.specialType){case"lunge":e>i*.2&&e<i*.7&&(this.body.body.setVelocityX(s*550),this._effectTimer>50&&(this._effectTimer=0,$(this.scene,this.x,this.y,s,this.data.color,4))),this._effectPhase<1&&e>i*.15&&(this._effectPhase=1,C(this.scene,this.x-s*20,n),y.whoosh());break;case"groundPound":e>i*.05&&e<i*.3&&this.body.body.setVelocityY(-600),e>i*.4&&e<i*.65&&(this.body.body.setVelocityY(1e3),this.body.body.setVelocityX(0)),this._effectPhase<1&&e>i*.05&&(this._effectPhase=1,C(this.scene,this.x,n,8947848)),this._effectPhase<2&&e>i*.55&&this.isGrounded&&(this._effectPhase=2,v(this.scene,this.x,n,this.data.color,100),B(this.scene,this.x,n),C(this.scene,this.x-30,n,6710886),C(this.scene,this.x+30,n,6710886),this.scene.cameras.main.shake(250,.02),y.heavyImpact());break;case"teleport":if(this._effectPhase<1&&e>i*.15&&(this._effectPhase=1,ht(this.scene,this.x,this.y,this.data.color),y.warp()),e>i*.3&&e<i*.35&&this.opponent){const h=this.opponent.x+(this.opponent.facingRight?-70:70);this.body.setPosition(f.Math.Clamp(h,d.STAGE_LEFT+30,d.STAGE_RIGHT-30),this.body.y)}this._effectPhase<2&&e>i*.35&&(this._effectPhase=2,ct(this.scene,this.x,this.y,this.data.color));break;case"uppercut":e>i*.2&&e<i*.5&&(this.body.body.setVelocityY(-700),this.body.body.setVelocityX(s*180),this._effectTimer>40&&(this._effectTimer=0,Q(this.scene,this.x,this.y+20,s,this.data.color))),this._effectPhase<1&&e>i*.15&&(this._effectPhase=1,Z(this.scene,this.x+s*20,this.y,this.data.color,10),y.risingAttack());break;case"slide":e>i*.15&&e<i*.7&&(this.body.body.setVelocityX(s*600),this._effectTimer>60&&(this._effectTimer=0,tt(this.scene,this.x,n,s,this.data.color))),this._effectPhase<1&&e>i*.1&&(this._effectPhase=1,et(this.scene,this.x,n,this.data.color),y.iceSlide());break;case"lightningDrop":e<i*.25&&(this.body.body.setVelocityY(-700),this.body.body.setVelocityX(s*120),this._effectTimer>60&&(this._effectTimer=0,N(this.scene,this.x,this.y,this.data.color,4))),e>i*.35&&e<i*.65&&(this.body.body.setVelocityY(1e3),this.body.body.setVelocityX(0)),this._effectPhase<1&&e>i*.5&&this.isGrounded&&(this._effectPhase=1,it(this.scene,this.x,0,this.x,n,this.data.color),N(this.scene,this.x,n,this.data.color,12),v(this.scene,this.x,n,this.data.color,60),this.scene.cameras.main.shake(150,.012),y.electric());break;case"flurry":if(e>i*.12&&e<i*.8){this.body.body.setVelocityX(s*280);const h=i*.68/(this.data.specialHits||4),o=e-i*.12,c=Math.floor(o/h);c>this.specialHitCount&&(this.specialHitCount=c,this.hasHit=!1,st(this.scene,this.x,this.y,s,this.data.color),y.flurryHit())}break;case"armorSmash":e<i*.5?(this.armorActive=!0,this._effectTimer>100&&(this._effectTimer=0,at(this.scene,this.x,this.y,this.data.color,45))):this.armorActive=!1,e>i*.45&&e<i*.65&&this.body.body.setVelocityX(s*400),this._effectPhase<1&&e>i*.5&&(this._effectPhase=1,B(this.scene,this.x+s*40,n,this.data.color),C(this.scene,this.x+s*40,n,8947848),this.scene.cameras.main.shake(150,.01),y.heavyImpact());break;case"whirlwind":if(e>i*.1&&e<i*.75&&(this.body.body.setVelocityX(s*180),this._effectTimer>50)){this._effectTimer=0;const h=e/i*Math.PI*8;nt(this.scene,this.x,this.y,h,this.data.color)}this._effectPhase<1&&e>i*.1&&(this._effectPhase=1,y.whoosh());break;case"explosion":if(e<i*.55){this.body.body.setVelocityX(0);const h=e/(i*.55);this._effectTimer>60&&(this._effectTimer=0,ot(this.scene,this.x,this.y,this.data.color,10+h*35))}this._effectPhase<1&&e>i*.55&&(this._effectPhase=1,rt(this.scene,this.x,this.y,this.data.color,130),this.scene.cameras.main.shake(300,.025),y.boom()),e>i*.6&&e<i*.7&&this.body.body.setVelocityX(-s*150);break}}enterState(t){switch(this.state=t,this.stateTimer=0,this.animFrame=0,this.animTimer=0,t){case l.PUNCH:y.punch();break;case l.KICK:y.kick();break;case l.SPECIAL:y.special();break;case l.JUMP:y.jump();break}[l.PUNCH,l.KICK,l.SPECIAL].includes(t)&&(this.canAct=!1,this.hasHit=!1),t===l.SPECIAL&&(this._effectPhase=0,this._effectTimer=0),t===l.HIT&&(this.canAct=!1)}isAttacking(){return[l.PUNCH,l.KICK,l.SPECIAL].includes(this.state)}isOnActiveFrame(){if(!this.isAttacking())return!1;let t,e,i;switch(this.state){case l.PUNCH:t=d.PUNCH_DURATION,e=t*.3,i=t*.6;break;case l.KICK:t=d.KICK_DURATION,e=t*.25,i=t*.6;break;case l.SPECIAL:switch(t=this.specialDuration,this.data.specialType){case"lunge":e=t*.25,i=t*.65;break;case"groundPound":e=t*.5,i=t*.7;break;case"teleport":e=t*.4,i=t*.7;break;case"uppercut":e=t*.2,i=t*.5;break;case"slide":e=t*.2,i=t*.7;break;case"lightningDrop":e=t*.45,i=t*.65;break;case"flurry":e=t*.12,i=t*.8;break;case"armorSmash":e=t*.5,i=t*.7;break;case"whirlwind":e=t*.12,i=t*.75;break;case"explosion":e=t*.55,i=t*.75;break;default:e=t*.2,i=t*.6}break;default:return!1}return this.stateTimer>=e&&this.stateTimer<=i}getAttackData(){switch(this.state){case l.PUNCH:return{damage:this.data.punchDamage,range:this.data.punchRange,knockback:d.PUNCH_KNOCKBACK};case l.KICK:return{damage:this.data.kickDamage,range:this.data.kickRange,knockback:d.KICK_KNOCKBACK};case l.SPECIAL:return{damage:this.data.specialDamage,range:this.data.specialRange,knockback:d.SPECIAL_KNOCKBACK};default:return null}}getHitboxRect(){const t=this.getAttackData();if(!t)return null;const e=this.facingRight?1:-1,i=this.x,s=this.y;if(this.state===l.SPECIAL)switch(this.data.specialType){case"explosion":return new f.Geom.Rectangle(i-t.range/2,s-t.range/3,t.range,t.range*.66);case"groundPound":return new f.Geom.Rectangle(i-t.range/2,s-20,t.range,60);case"whirlwind":return new f.Geom.Rectangle(i-t.range/2,s-30,t.range,60)}const a=e>0?i+d.BODY_WIDTH/2:i-d.BODY_WIDTH/2-t.range;return new f.Geom.Rectangle(a,s-25,t.range,50)}getHurtboxRect(){return new f.Geom.Rectangle(this.x-d.BODY_WIDTH/2,this.y-d.BODY_HEIGHT/2,d.BODY_WIDTH,d.BODY_HEIGHT)}takeDamage(t,e){if(this.armorActive){this.health-=t*.3,this.health=Math.max(0,this.health);return}this.state===l.BLOCK?(this.health-=t*(1-d.BLOCK_DAMAGE_REDUCTION),this.body.body.setVelocityX(e*.3)):(this.health-=t,this.body.body.setVelocityX(e),this.body.body.setVelocityY(-150),this.enterState(l.HIT)),this.health=Math.max(0,this.health),this.health<=0&&(this.enterState(l.KO),this.canAct=!1)}setFacing(t){this.facingRight=t}resetForRound(t){this.body.setPosition(t,d.GROUND_Y-d.BODY_HEIGHT/2),this.body.body.setVelocity(0,0),this.health=this.maxHealth,this.state=l.IDLE,this.stateTimer=0,this.specialCooldown=0,this.canAct=!0,this.hasHit=!1,this.specialHitCount=0,this.armorActive=!1,this._effectPhase=0,this._effectTimer=0}draw(){const t=w[this.state];if(!t)return;let e;const i=t.length;if(i===1)e=t[0];else{let n;switch(this.state){case l.PUNCH:n=d.PUNCH_DURATION;break;case l.KICK:n=d.KICK_DURATION;break;case l.SPECIAL:n=this.specialDuration;break;case l.KO:n=800;break;default:n=400;break}const h=n/i,o=Math.min(Math.floor(this.stateTimer/h),i-1),c=Math.min(o+1,i-1),p=this.stateTimer%h/h;o===c||this.state===l.KO?e=t[o]:e=J(t[o],t[c],p)}const s=this.x,a=this.y+d.BODY_HEIGHT/2-50;this.renderer.draw(s,a,e,this.facingRight,this.data.color)}destroy(){this.graphics.destroy(),this.body.destroy()}}const lt={0:{left:"A",right:"D",jump:"W",punch:"J",kick:"K",special:"L",block:"S"},1:{left:"LEFT",right:"RIGHT",jump:"UP",punch:"COMMA",kick:"PERIOD",special:"FORWARD_SLASH",block:"DOWN"}};class F{constructor(t,e){this.scene=t,this.playerIndex=e,this.gamepad=null;const i=lt[e];this.keys={};for(const s in i)this.keys[s]=t.input.keyboard.addKey(f.Input.Keyboard.KeyCodes[i[s]]);this.prevState={jump:!1,punch:!1,kick:!1,special:!1},t.input.gamepad&&(t.input.gamepad.on("connected",s=>{s.index===e&&!this.gamepad&&(this.gamepad=s)}),t.input.gamepad.pad1&&e===0&&(this.gamepad=t.input.gamepad.pad1),t.input.gamepad.pad2&&e===1&&(this.gamepad=t.input.gamepad.pad2))}getActions(){const t=this.readKeyboard(),e=this.readGamepad(),i={left:t.left||e.left,right:t.right||e.right,jump:t.jump||e.jump,punch:t.punch||e.punch,kick:t.kick||e.kick,special:t.special||e.special,block:t.block||e.block},s={left:i.left,right:i.right,jump:i.jump&&!this.prevState.jump,punch:i.punch&&!this.prevState.punch,kick:i.kick&&!this.prevState.kick,special:i.special&&!this.prevState.special,block:i.block};return this.prevState={jump:i.jump,punch:i.punch,kick:i.kick,special:i.special},s}readKeyboard(){return{left:this.keys.left.isDown,right:this.keys.right.isDown,jump:this.keys.jump.isDown,punch:this.keys.punch.isDown,kick:this.keys.kick.isDown,special:this.keys.special.isDown,block:this.keys.block.isDown}}readGamepad(){const t=this.gamepad,e={left:!1,right:!1,jump:!1,punch:!1,kick:!1,special:!1,block:!1};if(!t||!t.connected)return e;const i=.3,s=t.leftStick?t.leftStick.x:0;return{left:t.left||s<-i,right:t.right||s>i,jump:t.A,punch:t.B,kick:t.Y,special:t.X,block:t.L1||t.R1}}}class W{constructor(t,e,i,s,a,n){this.x=e,this.y=i,this.width=s,this.height=a,this.playerIndex=n,this.graphics=t.add.graphics(),this.graphics.setDepth(100)}update(t,e){const i=this.graphics;i.clear();const s=Math.max(0,t/e),a=this.width*s,n=this.playerIndex===0;i.fillStyle(3355443,1),i.fillRect(this.x,this.y,this.width,this.height);let h;s>.5?h=52292:s>.25?h=13421568:h=13369344,i.fillStyle(h,1),n?i.fillRect(this.x,this.y,a,this.height):i.fillRect(this.x+this.width-a,this.y,a,this.height),i.lineStyle(2,16777215,1),i.strokeRect(this.x,this.y,this.width,this.height)}destroy(){this.graphics.destroy()}}class U{constructor(t,e,i,s=!1){this.x=e,this.y=i,this.alignRight=s,this.graphics=t.add.graphics(),this.graphics.setDepth(100)}update(t){const e=this.graphics;e.clear();for(let i=0;i<d.ROUNDS_TO_WIN;i++){const s=this.alignRight?this.x-i*25:this.x+i*25;i<t&&(e.fillStyle(16763904,1),e.fillCircle(s,this.y,8)),e.lineStyle(2,6710886,1),e.strokeCircle(s,this.y,8)}}destroy(){this.graphics.destroy()}}class dt extends f.Scene{constructor(){super("FightScene")}create(){this.p1Wins=this.registry.get("p1Wins"),this.p2Wins=this.registry.get("p2Wins"),this.currentRound=this.registry.get("currentRound"),this.roundActive=!1,this.createArena(),this.createFighters(),this.createUI(),this.startRound()}createArena(){const t=this.add.graphics();t.fillStyle(1450302,1),t.fillRect(0,0,1280,d.GROUND_Y),t.fillStyle(3355460,1),t.fillRect(0,d.GROUND_Y,1280,100),t.lineStyle(3,5592439,1),t.lineBetween(0,d.GROUND_Y,1280,d.GROUND_Y),t.lineStyle(1,3355477,.5),t.lineBetween(d.STAGE_LEFT,0,d.STAGE_LEFT,d.GROUND_Y),t.lineBetween(d.STAGE_RIGHT,0,d.STAGE_RIGHT,d.GROUND_Y),this.physics.world.setBounds(d.STAGE_LEFT,0,d.STAGE_RIGHT-d.STAGE_LEFT,d.GROUND_Y),this.ground=this.add.zone(640,d.GROUND_Y+10,1280,20),this.physics.add.existing(this.ground,!0)}createFighters(){const i=k[this.registry.get("p1Fighter")||0],s=k[this.registry.get("p2Fighter")||1];this.p1Data=i,this.p2Data=s,this.fighter1=new G(this,350,d.GROUND_Y,0,!0,i),this.fighter2=new G(this,930,d.GROUND_Y,1,!1,s),this.fighter1.opponent=this.fighter2,this.fighter2.opponent=this.fighter1,this.physics.add.collider(this.fighter1.body,this.ground),this.physics.add.collider(this.fighter2.body,this.ground),this.physics.add.collider(this.fighter1.body,this.fighter2.body),this.p1Input=new F(this,0),this.p2Input=new F(this,1)}createUI(){this.p1HealthBar=new W(this,50,25,480,28,0),this.p2HealthBar=new W(this,750,25,480,28,1),this.add.text(50,7,this.p1Data.name,{fontSize:"14px",fontFamily:"monospace",color:`#${this.p1Data.color.toString(16).padStart(6,"0")}`}),this.add.text(1230,7,this.p2Data.name,{fontSize:"14px",fontFamily:"monospace",color:`#${this.p2Data.color.toString(16).padStart(6,"0")}`}).setOrigin(1,0),this.p1RoundInd=new U(this,50,71,!1),this.p2RoundInd=new U(this,1230,71,!0),this.add.text(640,30,"VS",{fontSize:"20px",fontFamily:"monospace",color:"#666666",fontStyle:"bold"}).setOrigin(.5),this.roundText=this.add.text(640,68,`Round ${this.currentRound}`,{fontSize:"13px",fontFamily:"monospace",color:"#555555"}).setOrigin(.5);const s=80,a=6,n=75;this.spBarConfig={w:s,h:a},this.add.text(50,n-10,"SP",{fontSize:"9px",fontFamily:"monospace",color:"#666666"}),this.add.text(1230,n-10,"SP",{fontSize:"9px",fontFamily:"monospace",color:"#666666"}).setOrigin(1,0),this.p1SpBar=this.add.graphics(),this.p1SpBarX=68,this.p1SpBarY=n-8,this.p2SpBar=this.add.graphics(),this.p2SpBarX=1230-s,this.p2SpBarY=n-8,this.p1HealthBar.update(d.MAX_HEALTH,d.MAX_HEALTH),this.p2HealthBar.update(d.MAX_HEALTH,d.MAX_HEALTH),this.p1RoundInd.update(this.p1Wins),this.p2RoundInd.update(this.p2Wins)}startRound(){this.roundActive=!1;const t=this.add.text(640,300,`ROUND ${this.currentRound}`,{fontSize:"64px",fontFamily:"monospace",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5).setDepth(200);this.time.delayedCall(1e3,()=>{t.setText("FIGHT!"),t.setColor("#ffcc00"),t.setFontSize("80px"),y.roundStart(),this.time.delayedCall(600,()=>{this.tweens.add({targets:t,alpha:0,duration:300,onComplete:()=>t.destroy()}),this.roundActive=!0})})}update(t,e){if(this.p1HealthBar.update(this.fighter1.health,this.fighter1.maxHealth),this.p2HealthBar.update(this.fighter2.health,this.fighter2.maxHealth),this.p1RoundInd.update(this.p1Wins),this.p2RoundInd.update(this.p2Wins),this.drawSpBar(this.p1SpBar,this.p1SpBarX,this.p1SpBarY,this.fighter1.specialCooldown,this.p1Data.color),this.drawSpBar(this.p2SpBar,this.p2SpBarX,this.p2SpBarY,this.fighter2.specialCooldown,this.p2Data.color),!this.roundActive)return;const i=this.p1Input.getActions(),s=this.p2Input.getActions();this.fighter1.update(e,i),this.fighter2.update(e,s),this.updateFacing(),this.checkHits(this.fighter1,this.fighter2),this.checkHits(this.fighter2,this.fighter1),this.fighter1.health<=0&&this.fighter1.state==="KO"?this.endRound(1):this.fighter2.health<=0&&this.fighter2.state==="KO"&&this.endRound(0)}updateFacing(){this.fighter1.x<this.fighter2.x?(this.fighter1.setFacing(!0),this.fighter2.setFacing(!1)):(this.fighter1.setFacing(!1),this.fighter2.setFacing(!0))}checkHits(t,e){if(!t.isAttacking()||!t.isOnActiveFrame()||t.hasHit)return;const i=t.getHitboxRect(),s=e.getHurtboxRect();if(!(!i||!s)&&f.Geom.Rectangle.Overlaps(i,s)){t.hasHit=!0;const a=t.getAttackData(),n=t.facingRight?1:-1,h=e.state==="BLOCK";e.takeDamage(a.damage,n*a.knockback),h?y.block():y.hit(),this.cameras.main.shake(100,.005*a.damage),this.createHitSpark(i.x+i.width/2,i.y+i.height/2,h)}}createHitSpark(t,e,i){const s=this.add.graphics();s.setDepth(50);const a=i?4491519:16755200,n=i?15:25;for(let h=0;h<8;h++){const o=Math.PI*2*h/8,c=n+Math.random()*10;s.lineStyle(3,a,1),s.lineBetween(t,e,t+Math.cos(o)*c,e+Math.sin(o)*c)}this.tweens.add({targets:s,alpha:0,duration:200,onComplete:()=>s.destroy()})}drawSpBar(t,e,i,s,a){const{w:n,h}=this.spBarConfig,o=s<=0?1:1-s/d.SPECIAL_COOLDOWN;t.clear(),t.fillStyle(1118498,.8),t.fillRect(e,i,n,h);const c=o>=1?16763904:a;t.fillStyle(c,o>=1?.9:.6),t.fillRect(e,i,n*o,h),t.lineStyle(1,o>=1?16763904:4473958,.8),t.strokeRect(e,i,n,h)}endRound(t){this.roundActive=!1,t===0?this.p1Wins++:this.p2Wins++;const e=t===0?this.fighter1:this.fighter2,i=t===0?this.fighter2:this.fighter1;e.enterState("VICTORY"),i.enterState("KO");const s=this.add.text(640,300,"K.O.!",{fontSize:"80px",fontFamily:"monospace",color:"#ff3333",fontStyle:"bold"}).setOrigin(.5).setDepth(200);y.ko(),this.cameras.main.shake(300,.01),this.time.delayedCall(d.ROUND_END_DELAY,()=>{s.destroy(),this.p1Wins>=d.ROUNDS_TO_WIN||this.p2Wins>=d.ROUNDS_TO_WIN?(this.registry.set("p1Wins",this.p1Wins),this.registry.set("p2Wins",this.p2Wins),this.registry.set("matchWinner",t),this.cleanUp(),this.scene.start("ResultScene")):(this.registry.set("p1Wins",this.p1Wins),this.registry.set("p2Wins",this.p2Wins),this.registry.set("currentRound",this.currentRound+1),this.cleanUp(),this.scene.restart())})}cleanUp(){this.fighter1.destroy(),this.fighter2.destroy(),this.p1HealthBar.destroy(),this.p2HealthBar.destroy(),this.p1RoundInd.destroy(),this.p2RoundInd.destroy()}}class pt extends f.Scene{constructor(){super("ResultScene")}create(){const t=this.registry.get("matchWinner"),e=this.registry.get("p1Wins"),i=this.registry.get("p2Wins"),s=this.registry.get("p1Fighter")||0,a=this.registry.get("p2Fighter")||1,n=t===0?k[s]:k[a],h=t===0?k[a]:k[s];y.victory();const o=t===0?"PLAYER 1":"PLAYER 2";this.add.text(640,120,`${o} WINS!`,{fontSize:"64px",fontFamily:"monospace",color:"#ffcc00",fontStyle:"bold"}).setOrigin(.5),this.add.text(640,190,n.name,{fontSize:"28px",fontFamily:"monospace",color:t===0?"#ffffff":"#00ffff"}).setOrigin(.5),this.add.text(640,250,`${e} - ${i}`,{fontSize:"48px",fontFamily:"monospace",color:"#ffffff"}).setOrigin(.5);const c=this.add.graphics();new L(c).draw(640,460,w.VICTORY[0],!0,n.color);const u=this.add.graphics(),T=new L(u),_=w.KO[w.KO.length-1],K=t===0?900:380;T.draw(K,480,_,t!==0,h.color);const A=this.add.text(640,620,"Press ENTER or SPACE to play again",{fontSize:"22px",fontFamily:"monospace",color:"#ffcc00"}).setOrigin(.5);this.tweens.add({targets:A,alpha:.3,duration:600,yoyo:!0,repeat:-1}),this.input.keyboard.on("keydown-ENTER",this.restart,this),this.input.keyboard.on("keydown-SPACE",this.restart,this),this.input.gamepad.on("down",()=>this.restart())}restart(){y.menuSelect(),this.scene.start("CharacterSelectScene")}}const ft={type:f.AUTO,width:1280,height:720,parent:"game-container",backgroundColor:"#1a1a2e",physics:{default:"arcade",arcade:{gravity:{y:1200},debug:!1}},scale:{mode:f.Scale.FIT,autoCenter:f.Scale.CENTER_BOTH},input:{gamepad:!0},scene:[z,q,j,dt,pt]};new f.Game(ft);
